# Ã‰tape 1 : Build
FROM node:latest

WORKDIR /app

ARG NODE_ENV
ENV NODE_ENV=$NODE_ENV
# ðŸ‘‡ DÃ©clare tes ARG (reÃ§oivent les valeurs de docker-compose/.env)
ARG MYSQL_ROOT_PASSWORD
ARG MYSQL_DATABASE
ARG MYSQL_USER
ARG MYSQL_PASSWORD
ARG NEXT_PUBLIC_API_URL
ARG NEXT_PUBLIC_ROOT_URL
ARG DATABASE_HOST
ARG DATABASE_USER
ARG DATABASE_PASSWORD
ARG DATABASE_NAME
ARG DATABASE_PORT

# ðŸ‘‡ Transforme-les en ENV pour que Next.js y ait accÃ¨s au build
ENV MYSQL_ROOT_PASSWORD=$MYSQL_ROOT_PASSWORD
ENV MYSQL_DATABASE=$MYSQL_DATABASE
ENV MYSQL_USER=$MYSQL_USER
ENV MYSQL_PASSWORD=$MYSQL_PASSWORD
ENV NEXT_PUBLIC_API_URL=$NEXT_PUBLIC_API_URL
ENV NEXT_PUBLIC_ROOT_URL=$NEXT_PUBLIC_ROOT_URL
ENV DATABASE_HOST=$DATABASE_HOST
ENV DATABASE_USER=$DATABASE_USER
ENV DATABASE_PASSWORD=$DATABASE_PASSWORD
ENV DATABASE_NAME=$DATABASE_NAME
ENV DATABASE_PORT=$DATABASE_PORT

COPY ./next-project/ .

RUN npm ci

RUN npm run build

EXPOSE 3000

CMD ["npm", "run", "start"]
